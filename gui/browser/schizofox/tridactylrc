" options

sanitise tridactylsync tridactyllocal

set newtab https://hn.algolia.com
set searchengine bing
set smoothscroll true
set leavegithubalone true


colorscheme midnight
guiset_quiet hoverlink right



" Ignored sites
"autocmd DocStart youtube.com mode ignore


" keymaps
keymap ; :
keymap : ;

" binding

bind gr reader
bind gR reader --tab

" up and down history
bind --mode=ex <ArrowUp> ex.prev_history
bind --mode=ex <ArrowDown> ex.next_history
unbind <C-f>
unbindurl github.com --mode=normal t
bind ;c hint -Jc [class*="expand"],[class="togg"],[class="comment_folder"]
bind R source

""" Scroll to next/prev section with }/{
bind { js (function() { var prevTargetElements = document.querySelectorAll('h1, h2, h3, h4, h5, h6, hr, section, article, aside, nav, header, main'); var currentY = window.scrollY; for (var i = prevTargetElements.length - 1; i >= 0; i--) { var pElementY = prevTargetElements[i].getBoundingClientRect().top + window.scrollY; if (pElementY < currentY) { window.scrollTo({ top: pElementY, behavior: 'smooth' }); break; } } })();
bind } js (function() { var nextTargetElements = document.querySelectorAll('h1, h2, h3, h4, h5, h6, hr, section, article, aside, nav, header, main'); var currentY = window.scrollY; for (var i = 0; i < nextTargetElements.length; i++) { var nElementY = nextTargetElements[i].getBoundingClientRect().top + window.scrollY; if (nElementY > (currentY+1)) { window.scrollTo({ top: nElementY, behavior: 'smooth', block: 'start' }); break; } } })();


" quick search engines

set searchurls.tw https://twitter.com/search?q=%s
set searchurls.yt https://www.youtube.com/results?search_query=%s
set searchurls.s https://sourcegraph.com/search?q=%s
set searchurls.gh https://github.com/search?q=%s
set searchurls.np https://search.nixos.org/packages?query=%s
set searchurls.no https://search.nixos.org/options?query=%s
set searchurls.hm https://home-manager-options.extranix.com/?query=%s
set searchurls.wh https://www.wordhippo.com/what-is/another-word-for/%s.html
set searchurls.wb https://web.archive.org/web/*/%s



" marks
quickmark g https://chatgpt.com

command wayback composite get_current_url | tabopen wb

" extras

" Git{Hub,Lab} git clone via SSH yank
bind yg composite js "git clone " + document.location.href.replace(/https?:\/\//,"git@").replace("/",":").replace(/$/,".git") | clipboard yank

" As above but execute it and open terminal in folder
bind ,g js let uri = document.location.href.replace(/https?:\/\//,"git@").replace("/",":").replace(/$/,".git"); tri.native.run("cd ~/projects; git clone " + uri + "; cd \"$(basename \"" + uri + "\" .git)\"; st")
 

command hinttaball js let bAllWindows=!0;if(void 0!==tri.hinttabs)tri.hinttabs.showAndHint(bAllWindows);else{tri.hinttabs={};let t=tri.hinttabs;function e(t,e="",i="",a=""){let n=document.createElement(t);return""!=e&&(n.className=e),""!==i&&(n.id=i),n.textContent=a,n}function i(){let t=document.createDocumentFragment(),i=e("div","","ctrls");return i.replaceChildren(e("div","TridactylTabHint ctrl","prev","<--"),e("div","TridactylTabHint ctrl","next","-->"),e("div","TridactylTabHint ctrl","close","X"),e("div","TridactylTabHint ctrl","newtab","+"),e("div","TridactylTabHint ctrl","search","search")),t.appendChild(i),t}function a(){let t=document.createElement("template");t.id="tabtemplate";let e=document.createElement("div");e.className="tab TridactylTabHint";let i=document.createElement("div");i.className="icons";let a=document.createElement("img");a.src="chrome://global/skin/icons/indicator-private-browsing.svg",a.className="incogicon";let n=document.createElement("img");n.className="favicon";let r=document.createElement("div");r.className="text";let l=document.createElement("p");l.className="title";let d=document.createElement("p");return d.className="url",i.appendChild(a),i.appendChild(document.createElement("br")),i.appendChild(n),r.appendChild(l),r.appendChild(document.createElement("br")),r.appendChild(d),e.appendChild(i),e.appendChild(r),t.content.appendChild(e),t}async function n(e=!0){t.tabs=await tri.browserBg.tabs.query(e?{}:{currentWindow:!0});let n=document.createDocumentFragment();t.shadowHost=document.createElement("div"),t.shadowHost.id="TridactylHintTabs";let r=t.shadowHost.attachShadow({mode:"open"}),l=document.createElement("style");l.textContent=t.css,r.appendChild(l),t.tabTemplate=a(),r.appendChild(t.tabTemplate);let d=document.createElement("div");d.id="dimmer",d.style["z-index"]=2147483645,r.appendChild(d);let s=document.createElement("div");s.id="outermost",s.style.zIndex=2147483646;let o=document.createElement("div");o.id="gridalign",t.hintGrid=document.createElement("div"),t.hintGrid.id="tabs",o.appendChild(i()),s.appendChild(o),o.appendChild(t.hintGrid),r.appendChild(s),n.appendChild(t.shadowHost),document.documentElement.appendChild(n)}function r(t,e){let i=t.querySelector(".favicon");return void 0!==e.favIconUrl?(i.src=e.favIconUrl,i.style.visibility="inherit"):i.style.visibility="hidden",t.tabid=e.id,t.querySelector(".incogicon").style.visibility=e.incognito?"inherit":"hidden",t.querySelector(".title").textContent=e.title,t.querySelector(".url").textContent=e.url,t}t.css="img,p{display:inline}#dimmer,#outermost{position:fixed;height:100%}#ctrls,#tabs{display:grid;grid-gap:var(--tri-tabs-grid-gap);width:100%}#ctrls,#dimmer,#outermost,#tabs{width:100%}#tabs,.ctrl,.tab,.text{overflow:clip}#gridalign,:root{font-size:9pt;font-family:monospace;color:#fff;--grid-column-count:4;--grid-item--min-width:400px;--tri-tabs-title-font-size:1em;--tri-tabs-url-font-size:1em;--tri-tabs-line-height:1.4em;--tri-tabs-grid-gap:0.4em;--tri-tabs-padding-top:0.5em;--tri-tabs-padding-bottom:0.5em;--tri-tabs-icon-size:1em;--tri-tabs-tab-height:calc( max( var(--tri-tabs-line-height), var(--tri-tabs-title-font-size), var(--tri-tabs-icon-size) ) + max( var(--tri-tabs-line-height), var(--tri-tabs-url-font-size), var(--tri-tabs-icon-size) ) );--tri-tabs-tab-padded:calc(var(--tri-tabs-tab-height) + var(--tri-tabs-padding-top) + var(--tri-tabs-padding-bottom));--tri-tabs-tab-spacing:calc(var(--tri-tabs-tab-padded) + var(--tri-tabs-grid-gap));--gap-count:calc(var(--grid-column-count) - 1);--total-gap-width:calc(var(--gap-count) * var(--tri-tabs-grid-gap));--grid-item--max-width:calc((100% - var(--total-gap-width)) / var(--grid-column-count))}.icons{float:left;padding-right:1em;padding-left:1em;height:100%}.text{display:block;align-content:center;white-space:nowrap;text-overflow:ellipsis;color:#f0f0f0}.title{font-size:var(--tri-tabs-title-font-size)}.url{font-size:var(--tri-tabs-url-font-size);color:#6a5acd}img{width:var(--tri-tabs-icon-size)}#dimmer{top:0;background:rgba(31,7,47,.5)}#outermost{top:1em}#gridalign{width:80%;margin:auto}#tabs{background-size:var(--tri-tabs-tab-spacing);grid-template-columns:repeat(auto-fill,minmax(max(var(--grid-item--min-width),var(--grid-item--max-width)),1fr));margin:auto}#ctrls{grid-template-columns:repeat(auto-fit,minmax(5em,1fr));padding-bottom:var(--tri-tabs-grid-gap);text-align:center}.ctrl,.tab{outline:slateblue solid 1px;outline-offset:-1px;background:#101216;line-height:var(--tri-tabs-line-height)}.tab{height:var(--tri-tabs-tab-height);padding:var(--tri-tabs-padding-top) 1em var(--tri-tabs-padding-bottom) .5em}.ctrl{height:calc(var(--tri-tabs-tab-height)/ 2);padding:var(--tri-tabs-padding-top) 1.5em var(--tri-tabs-padding-bottom) 1.5em}.TridactylHintActive{background:#20242c}.TridactylHintActive,.TridactylHintActive>.text>.title{color:#fff}.TridactylHintActive>.text>.url{color:#ff0}",t.firstTab=0,t.faketab={id:"fake",url:"",title:"",favIconUrl:"",incognito:!1},t.maxCells=function(e){let i=getComputedStyle(t.hintGrid),a,n=Math.max(1,Math.floor((innerHeight-t.hintGrid.getBoundingClientRect().top)/parseFloat(i.backgroundSize))),r=i.gridTemplateColumns.split(" ").length;t.maxVisibleCells=r*n;let l=Math.min(e,r*n);return t.hintCount=l,l},t.makeHints=async function(){let e=document.createDocumentFragment();for(let i=0;i<t.hintCount;++i){e.appendChild(t.tabTemplate.content.cloneNode(!0));let a=e.lastChild;r(a,t.tabs[i+t.firstTab]),a.index=i}t.hintGrid.replaceChildren(...e.children)},t.refreshTabList=async function(e){t.tabs=await tri.browserBg.tabs.query(e?{}:{currentWindow:!0}),t.firstTab=0,t.hintCount=t.maxCells(t.tabs.length),t.makeHints()},t.gototab=async function(t){let e=await tri.browserBg.tabs.update(t,{active:!0});return await tri.browserBg.windows.update(e.windowId,{focused:!0}),e},t.updateHints=function(){for(let e=0;e<t.hintCount;++e)r(t.hintGrid.children[e],t.tabs[e+t.firstTab]);for(let i=t.hintCount;i<t.hintGrid.childElementCount;++i)r(t.hintGrid.children[i],t.faketab)},t.nextTabs=function(){let e=t.firstTab+t.hintGrid.childElementCount;e<t.tabs.length&&(t.firstTab=e,t.hintCount=Math.min(t.tabs.length-e,t.hintGrid.childElementCount),t.updateHints()),t.hint()},t.prevTabs=function(){let e=t.firstTab-t.maxVisibleCells;e>=0&&(t.firstTab=e,t.hintCount=Math.min(t.tabs.length-e,t.maxVisibleCells),t.updateHints()),t.hint()},t.showAndHint=async function(e=!0){t.shadowHost.style.visibility="visible",await t.refreshTabList(e),t.makeHints().then(e=>{t.hint()})},t.hide=function(){t.shadowHost.style.visibility="hidden"},t.hint=function(){return tri.excmds.hint("-c",".TridactylTabHint").then(function(e){if(""===e)t.hide();else if(void 0!==e.tabid)"fake"===e.tabid?t.hint():(t.gototab(e.tabid),t.hide());else switch(e.id){case"prev":t.prevTabs();break;case"next":t.nextTabs();break;case"close":tri.excmds.tabclose();break;case"newtab":tri.excmds.tabopen(),t.hide();break;case"search":tri.excmds.fillcmdline("taball"),t.hide();break;default:t.hide()}})},n(bAllWindows).then(function(){t.maxCells(t.tabs.length),t.makeHints().then(()=>{t.hint()})})}

command hinttabs js let bAllWindows=!1;if(void 0!==tri.hinttabs)tri.hinttabs.showAndHint(bAllWindows);else{tri.hinttabs={};let t=tri.hinttabs;function e(t,e="",i="",a=""){let n=document.createElement(t);return""!=e&&(n.className=e),""!==i&&(n.id=i),n.textContent=a,n}function i(){let t=document.createDocumentFragment(),i=e("div","","ctrls");return i.replaceChildren(e("div","TridactylTabHint ctrl","prev","<--"),e("div","TridactylTabHint ctrl","next","-->"),e("div","TridactylTabHint ctrl","close","X"),e("div","TridactylTabHint ctrl","newtab","+"),e("div","TridactylTabHint ctrl","search","search")),t.appendChild(i),t}function a(){let t=document.createElement("template");t.id="tabtemplate";let e=document.createElement("div");e.className="tab TridactylTabHint";let i=document.createElement("div");i.className="icons";let a=document.createElement("img");a.src="chrome://global/skin/icons/indicator-private-browsing.svg",a.className="incogicon";let n=document.createElement("img");n.className="favicon";let r=document.createElement("div");r.className="text";let l=document.createElement("p");l.className="title";let d=document.createElement("p");return d.className="url",i.appendChild(a),i.appendChild(document.createElement("br")),i.appendChild(n),r.appendChild(l),r.appendChild(document.createElement("br")),r.appendChild(d),e.appendChild(i),e.appendChild(r),t.content.appendChild(e),t}async function n(e=!0){t.tabs=await tri.browserBg.tabs.query(e?{}:{currentWindow:!0});let n=document.createDocumentFragment();t.shadowHost=document.createElement("div"),t.shadowHost.id="TridactylHintTabs";let r=t.shadowHost.attachShadow({mode:"open"}),l=document.createElement("style");l.textContent=t.css,r.appendChild(l),t.tabTemplate=a(),r.appendChild(t.tabTemplate);let d=document.createElement("div");d.id="dimmer",d.style["z-index"]=2147483645,r.appendChild(d);let s=document.createElement("div");s.id="outermost",s.style.zIndex=2147483646;let o=document.createElement("div");o.id="gridalign",t.hintGrid=document.createElement("div"),t.hintGrid.id="tabs",o.appendChild(i()),s.appendChild(o),o.appendChild(t.hintGrid),r.appendChild(s),n.appendChild(t.shadowHost),document.documentElement.appendChild(n)}function r(t,e){let i=t.querySelector(".favicon");return void 0!==e.favIconUrl?(i.src=e.favIconUrl,i.style.visibility="inherit"):i.style.visibility="hidden",t.tabid=e.id,t.querySelector(".incogicon").style.visibility=e.incognito?"inherit":"hidden",t.querySelector(".title").textContent=e.title,t.querySelector(".url").textContent=e.url,t}t.css="img,p{display:inline}#dimmer,#outermost{position:fixed;height:100%}#ctrls,#tabs{display:grid;grid-gap:var(--tri-tabs-grid-gap);width:100%}#ctrls,#dimmer,#outermost,#tabs{width:100%}#tabs,.ctrl,.tab,.text{overflow:clip}#gridalign,:root{font-size:9pt;font-family:monospace;color:#fff;--grid-column-count:4;--grid-item--min-width:400px;--tri-tabs-title-font-size:1em;--tri-tabs-url-font-size:1em;--tri-tabs-line-height:1.4em;--tri-tabs-grid-gap:0.4em;--tri-tabs-padding-top:0.5em;--tri-tabs-padding-bottom:0.5em;--tri-tabs-icon-size:1em;--tri-tabs-tab-height:calc( max( var(--tri-tabs-line-height), var(--tri-tabs-title-font-size), var(--tri-tabs-icon-size) ) + max( var(--tri-tabs-line-height), var(--tri-tabs-url-font-size), var(--tri-tabs-icon-size) ) );--tri-tabs-tab-padded:calc(var(--tri-tabs-tab-height) + var(--tri-tabs-padding-top) + var(--tri-tabs-padding-bottom));--tri-tabs-tab-spacing:calc(var(--tri-tabs-tab-padded) + var(--tri-tabs-grid-gap));--gap-count:calc(var(--grid-column-count) - 1);--total-gap-width:calc(var(--gap-count) * var(--tri-tabs-grid-gap));--grid-item--max-width:calc((100% - var(--total-gap-width)) / var(--grid-column-count))}.icons{float:left;padding-right:1em;padding-left:1em;height:100%}.text{display:block;align-content:center;white-space:nowrap;text-overflow:ellipsis;color:#f0f0f0}.title{font-size:var(--tri-tabs-title-font-size)}.url{font-size:var(--tri-tabs-url-font-size);color:#6a5acd}img{width:var(--tri-tabs-icon-size)}#dimmer{top:0;background:rgba(31,7,47,.5)}#outermost{top:1em}#gridalign{width:80%;margin:auto}#tabs{background-size:var(--tri-tabs-tab-spacing);grid-template-columns:repeat(auto-fill,minmax(max(var(--grid-item--min-width),var(--grid-item--max-width)),1fr));margin:auto}#ctrls{grid-template-columns:repeat(auto-fit,minmax(5em,1fr));padding-bottom:var(--tri-tabs-grid-gap);text-align:center}.ctrl,.tab{outline:slateblue solid 1px;outline-offset:-1px;background:#101216;line-height:var(--tri-tabs-line-height)}.tab{height:var(--tri-tabs-tab-height);padding:var(--tri-tabs-padding-top) 1em var(--tri-tabs-padding-bottom) .5em}.ctrl{height:calc(var(--tri-tabs-tab-height)/ 2);padding:var(--tri-tabs-padding-top) 1.5em var(--tri-tabs-padding-bottom) 1.5em}.TridactylHintActive{background:#20242c}.TridactylHintActive,.TridactylHintActive>.text>.title{color:#fff}.TridactylHintActive>.text>.url{color:#ff0}",t.firstTab=0,t.faketab={id:"fake",url:"",title:"",favIconUrl:"",incognito:!1},t.maxCells=function(e){let i=getComputedStyle(t.hintGrid),a,n=Math.max(1,Math.floor((innerHeight-t.hintGrid.getBoundingClientRect().top)/parseFloat(i.backgroundSize))),r=i.gridTemplateColumns.split(" ").length;t.maxVisibleCells=r*n;let l=Math.min(e,r*n);return t.hintCount=l,l},t.makeHints=async function(){let e=document.createDocumentFragment();for(let i=0;i<t.hintCount;++i){e.appendChild(t.tabTemplate.content.cloneNode(!0));let a=e.lastChild;r(a,t.tabs[i+t.firstTab]),a.index=i}t.hintGrid.replaceChildren(...e.children)},t.refreshTabList=async function(e){t.tabs=await tri.browserBg.tabs.query(e?{}:{currentWindow:!0}),t.firstTab=0,t.hintCount=t.maxCells(t.tabs.length),t.makeHints()},t.gototab=async function(t){let e=await tri.browserBg.tabs.update(t,{active:!0});return await tri.browserBg.windows.update(e.windowId,{focused:!0}),e},t.updateHints=function(){for(let e=0;e<t.hintCount;++e)r(t.hintGrid.children[e],t.tabs[e+t.firstTab]);for(let i=t.hintCount;i<t.hintGrid.childElementCount;++i)r(t.hintGrid.children[i],t.faketab)},t.nextTabs=function(){let e=t.firstTab+t.hintGrid.childElementCount;e<t.tabs.length&&(t.firstTab=e,t.hintCount=Math.min(t.tabs.length-e,t.hintGrid.childElementCount),t.updateHints()),t.hint()},t.prevTabs=function(){let e=t.firstTab-t.maxVisibleCells;e>=0&&(t.firstTab=e,t.hintCount=Math.min(t.tabs.length-e,t.maxVisibleCells),t.updateHints()),t.hint()},t.showAndHint=async function(e=!0){t.shadowHost.style.visibility="visible",await t.refreshTabList(e),t.makeHints().then(e=>{t.hint()})},t.hide=function(){t.shadowHost.style.visibility="hidden"},t.hint=function(){return tri.excmds.hint("-c",".TridactylTabHint").then(function(e){if(""===e)t.hide();else if(void 0!==e.tabid)"fake"===e.tabid?t.hint():(t.gototab(e.tabid),t.hide());else switch(e.id){case"prev":t.prevTabs();break;case"next":t.nextTabs();break;case"close":tri.excmds.tabclose();break;case"newtab":tri.excmds.tabopen(),t.hide();break;case"search":tri.excmds.fillcmdline("taball"),t.hide();break;default:t.hide()}})},n(bAllWindows).then(function(){t.maxCells(t.tabs.length),t.makeHints().then(()=>{t.hint()})})}


// to bind commands to keys use bind <key bind> hinttaball or bind <key bind> hinttabs, eg:

bind T hinttaball
